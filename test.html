<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta name="description" content="废土战记">
    <meta name="author" content="路漫漫">
    <title>Title</title>
    <script src="http://cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>
</head>
<style>
    @keyframes aniMove{
        100%{background-position-x:72px;}
    }

    @keyframes aniFrame{
        100%{background-position-x:72px;}
    }

    #sprite {
        width: 24px;
        height: 24px;
        background-image: url("images/charasets/NPC (6).png");
        animation: aniMove steps(3,end) 0.3s infinite;
        animation-play-state:paused;
    }
</style>
<body>
<div id="sprite"></div>
</body>
<script>
    // 页面重绘前，通知浏览器调用一个指定的函数
    // 具体看https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame
    var requestAnimFrame = (function(){
        return window.requestAnimationFrame       ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame    ||
            window.oRequestAnimationFrame      ||
            window.msRequestAnimationFrame     ||
            function(callback){
                window.setTimeout(callback, 1000 / 60);//一秒60帧
            };
    })();

    // The main game loop
    var lastTime;
    function main() {
        var now = Date.now();
        var dt = (now - lastTime) / 1000.0;

        handleInput(dt);

        lastTime = now;
        //注意该API是在canvas下作用的，所以替换为setTimeout,但是setTimeout是不精确的不精确的不精确的！！！;
//        requestAnimFrame(main);
        window.setTimeout(main, 1000 / 60);//一秒60帧

    }

    //input对象，保存用户按键动作，供全局调用
    (function() {
        var pressedKeys = {};

        function setKey(event, status) {
            var code = event.keyCode;
            var key;

            switch(code) {
                case 32:
                    key = 'SPACE'; break;
                case 37:
                    key = 'LEFT'; break;
                case 38:
                    key = 'UP'; break;
                case 39:
                    key = 'RIGHT'; break;
                case 40:
                    key = 'DOWN'; break;
                default:
                    // Convert ASCII codes to letters
                    key = String.fromCharCode(code);
            }

            pressedKeys[key] = status;
        }

        document.addEventListener('keydown', function(e) {
            setKey(e, true);
        });

        document.addEventListener('keyup', function(e) {
            setKey(e, false);
            $("#sprite").css({
                "animation-play-state" : "paused"
            });
        });

        window.addEventListener('blur', function() {
            pressedKeys = {};
        });

        window.input = {
            isDown: function(key) {
                return pressedKeys[key.toUpperCase()];
            }
        };
    })();


    function handleInput() {
        if(input.isDown('DOWN') || input.isDown('s')) {
            $("#sprite").css({
                "background-position-y" : "0px",
                "animation-play-state" : "running"
            });
        }

        if(input.isDown('UP') || input.isDown('w')) {
            $("#sprite").css({
                "background-position-y" : "24px",
                "animation-play-state" : "running"
            });
        }

        if(input.isDown('LEFT') || input.isDown('a')) {
            $("#sprite").css({
                "background-position-y" : "72px",
                "animation-play-state" : "running"
            });
        }

        if(input.isDown('RIGHT') || input.isDown('d')) {
            $("#sprite").css({
                "background-position-y" : "48px",
                "animation-play-state" : "running"
            });
        }
    }

    main();
</script>
</html>